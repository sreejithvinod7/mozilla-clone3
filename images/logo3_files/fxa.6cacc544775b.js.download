!function(){"use strict";var t={},e=Mozilla.Client,r=["https://accounts.firefox.com/","https://accounts.stage.mozaws.net/"];t.updateURL=function(t){var e=t.indexOf("?")>0?"&":"?";return t+=e+"context=fx_desktop_v3"},t.getHostName=function(t){var e=t.match(/^https?:\/\/(?:[^/?#]+)(?:[/?#]|$)/i);return e&&e[0]},t.interceptFxANavigation=function(t){t.preventDefault();for(var e=new URL(t.target.href).search,r=new window._SearchParams(e).params,n={},a=/^[\w/.%-]+$/,o=["flow_id","flow_begin_time","device_id","entrypoint","entrypoint_experiment","entrypoint_variation","utm_source","utm_campaign","utm_content","utm_term","utm_medium"],i=0;i<o.length;i++){var c=o[i];if(Object.prototype.hasOwnProperty.call(r,c)){var s=decodeURIComponent(r[c]);a.test(s)&&(n[c]=s)}}var u=n.entrypoint;return delete n.entrypoint,Mozilla.UITour.showFirefoxAccounts(n,u)},t.init=function(n){if(n=n||function(){},e._isFirefoxDesktop()){var a=parseFloat(e._getFirefoxVersion())>=80&&"undefined"!=typeof Mozilla.UITour,o=document.querySelectorAll(".js-fxa-cta-link");a&&Mozilla.UITour.ping((function(){for(var e=0;e<o.length;e++){var a=o[e],i=t.getHostName(a.href);i&&-1===r.indexOf(i)||(a.href=t.updateURL(a.href),a.setAttribute("role","button"),a.oncontextmenu=function(t){t.preventDefault()},a.addEventListener("auxclick",t.interceptFxANavigation),a.addEventListener("click",t.interceptFxANavigation))}n()}))}};var n=t,a={},o=["https://accounts.firefox.com/","https://accounts.stage.mozaws.net/","https://monitor.mozilla.org/","https://getpocket.com/","https://vpn.mozilla.org/","https://stage.guardian.nonprod.cloudops.mozgcp.net/","https://guardian-dev.herokuapp.com/"],i=["utm_source","utm_campaign","utm_content","utm_term","utm_medium"],c=["device_id","flow_id","flow_begin_time","entrypoint_experiment","entrypoint_variation"],s=/^[\w/.%-]+$/,u="fxa-product-referral-id";a.getHostName=function(t){var e=t.match(/^https?:\/\/(?:[^/?#]+)(?:[/?#]|$)/i);return e&&e[0]},a.getFxALinkReferralData=function(){var t;if("undefined"!=typeof Mozilla.Cookies&&Mozilla.Cookies.enabled()&&a.hasFxALinkReferralCookie()){var e=a.getFxALinkReferralCookie();if("string"==typeof e&&s.test(e)){var r="www.mozilla.org";-1!==e.indexOf("whatsnew")&&(r="www.mozilla.org-whatsnew"),-1!==e.indexOf("welcome")&&(r="www.mozilla.org-welcome"),t={entrypoint:r,utm_source:r,utm_medium:"referral",utm_campaign:e}}}return t||null},a.getSearchReferralData=function(t){var e="string"==typeof t?t:document.referrer,r={utm_medium:"organic"};switch(!0){case/^https?:\/\/www\.google\.\w{2,3}(\.\w{2})?\/?/.test(e):r.utm_source="google";break;case/^https?:\/\/www\.bing\.com\/?/.test(e):r.utm_source="bing";break;case/^https?:\/\/(\w*\.)?search\.yahoo\.com\/?/.test(e):r.utm_source="yahoo";break;case/^https?:\/\/duckduckgo\.com\/?/.test(e):r.utm_source="duckduckgo";break;case/^https?:\/\/yandex\.\w{2,3}(\.\w{2})?\/?/.test(e):r.utm_source="yandex";break;case/^https?:\/\/www\.baidu\.com\/?/.test(e):r.utm_source="baidu";break;case/^https?:\/\/search\.naver\.com\/?/.test(e):r.utm_source="naver";break;default:r=null}return r},a.hasFxALinkReferralCookie=function(){return Mozilla.Cookies.hasItem(u)},a.getFxALinkReferralCookie=function(){return Mozilla.Cookies.getItem(u)},a.setFxALinkReferralCookie=function(t){var e="undefined"!=typeof Mozilla.Cookies&&Mozilla.Cookies.enabled();if(t&&e&&!a.hasFxALinkReferralCookie()){var r=new Date;r.setTime(r.getTime()+36e5);var n=r.toUTCString();Mozilla.Cookies.setItem("fxa-product-referral-id",t,n,"/",undefined,!1,"lax")}},a.onFxALinkReferralClick=function(t){var e="_blank"===t.target.target||t.metaKey||t.ctrlKey,r=t.target.getAttribute("data-referral-id");e||t.preventDefault(),a.setFxALinkReferralCookie(r),e||(window.location.href=t.target.href)},a.bindFxALinkReferrals=function(){for(var t=document.querySelectorAll(".js-fxa-product-referral-link"),e=0;e<t.length;e++)t[e].addEventListener("click",a.onFxALinkReferralClick,!1)},a.filterParams=function(t,e){for(var r={},n=0;n<e.length;n++){var a=e[n];if(Object.prototype.hasOwnProperty.call(t,a))try{var o=decodeURIComponent(t[a]);s.test(o)&&(r[a]=o)}catch(i){}}return r},a.getUtmData=function(t){var e=a.filterParams(t,i);return Object.prototype.hasOwnProperty.call(e,"utm_source")&&Object.prototype.hasOwnProperty.call(e,"utm_campaign")?e:null},a.getExperimentData=function(t){var e=a.filterParams(t,c);return Object.prototype.hasOwnProperty.call(e,"entrypoint_experiment")&&Object.prototype.hasOwnProperty.call(e,"entrypoint_variation")?e:null},a.appendToProductURL=function(t,e){var r,n;if(t.indexOf("?")>0){if(n=window._SearchParams.queryStringToObject(t.split("?")[1]),Object.prototype.hasOwnProperty.call(e,"utm_source")&&Object.prototype.hasOwnProperty.call(e,"utm_campaign"))for(var a=0;a<i.length;a++){var o=i[a];Object.prototype.hasOwnProperty.call(n,o)&&delete n[o]}if(Object.prototype.hasOwnProperty.call(e,"entrypoint_experiment")&&Object.prototype.hasOwnProperty.call(e,"entrypoint_variation"))for(var s=0;s<c.length;s++){var u=c[s];Object.prototype.hasOwnProperty.call(n,u)&&delete n[u]}r=Object.assign(n,e)}else r=e;return t.split("?")[0]+"?"+window._SearchParams.objectToQueryString(r)},a.getAttributionData=function(t){var e={},r=a.getUtmData(t),n=a.getExperimentData(t);if(r)e=Object.assign(e,r);else{var o=a.getFxALinkReferralData();if(o)e=Object.assign(e,o);else{var i=a.getSearchReferralData();i&&(e=Object.assign(e,i))}}return n&&(e=Object.assign(e,n)),e},a.init=function(t){if("function"==typeof Object.assign){var e=document.querySelectorAll(".js-fxa-cta-link, .js-fxa-product-cta-link");a.bindFxALinkReferrals();var r=a.getAttributionData(t);if(0!==Object.keys(r).length)for(var n=0;n<e.length;n++){var i=e[n].hasAttribute("href")?e[n].href:null;if(i){var c=a.getHostName(i);if(c&&-1!==o.indexOf(c)){var s=a.appendToProductURL(i,r);e[n].href=s}}}}};var l=a,f={},p=["accounts.firefox.com","accounts.stage.mozaws.net"];f.getCoupon=function(t){var e=t.searchParams.get("coupon");return e&&/^[\w/.%-]+$/.test(e)?e:null},f.verifyLink=function(t){return-1!==p.indexOf(t.hostname)&&t.pathname.startsWith("/subscriptions/products/")},f.init=function(t){if(window.URL)try{var e=new URL(t),r=f.getCoupon(e);if(!r)return!1;for(var n=document.querySelectorAll(".js-fxa-cta-link, .js-fxa-product-cta-link"),a=0;a<n.length;a++){var o=n[a].hasAttribute("href")?n[a].href:null;if(o){var i=new URL(o);f.verifyLink(i)&&(i.searchParams.append("coupon",r),n[a].href=i)}}return!0}catch(c){return!1}};var m=f;var d="moz-consent-pref";var h={initAttribution:function(){if("undefined"!=typeof window._SearchParams){var t=new window._SearchParams;l.init(t.params)}},handleConsent:function(t){t.detail.analytics&&h.initAttribution(),window.removeEventListener("mozConsentStatus",h.handleConsent,!1)},initConsent:function(){if((e=document.getElementsByTagName("html")[0].getAttribute("data-needs-consent"))&&"true"===e.toLowerCase())window.addEventListener("mozConsentStatus",h.handleConsent,!1);else{var t=function(){try{return JSON.parse(window.Mozilla.Cookies.getItem(d))}catch(t){return!1}}();if(t&&!t.analytics)return;h.initAttribution()}var e},init:function(){m.init(window.location.href),h.initConsent(),"undefined"!=typeof window._SearchParams&&n.init()}};h.init()}();